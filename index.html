<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="shortcut icon" href="favicon.ico">
<title>Kettle Bell Genie</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="auth.css">
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- Full-Screen Workout Timer Overlay -->
<div class="timer-fullscreen" id="timer-fullscreen">
  <div class="fs-label">Workout Timer</div>
  <div class="fs-clock" id="fs-clock">00:00</div>
  <div class="fs-exercise-name" id="fs-exercise-name"></div>
  <div class="fs-exercise-detail" id="fs-exercise-detail"></div>
  <div class="fs-illustration"></div>
  <div class="fs-upnext" id="fs-upnext"></div>
  <div class="fs-progress" id="fs-progress"></div>
  <div class="fs-controls">
    <button class="btn btn-secondary" onclick="timerPrevExercise()">Prev</button>
    <button class="btn btn-primary" id="fs-pause-btn" onclick="timerTogglePause()">Pause</button>
    <button class="btn btn-secondary" onclick="timerNextExercise()">Next</button>
  </div>
  <button class="btn btn-danger fs-end" onclick="stopWorkoutTimer()">End Workout</button>
</div>

<div class="header">
  <div>
    <h1>Kettle Bell Genie</h1>
    <div class="header-subtitle">Your Workouts, On Command</div>
  </div>
  <div style="display:flex;align-items:center;gap:8px">
    <button id="auth-signin-btn" class="btn btn-sm btn-secondary" onclick="signInWithGoogle()">Sign In</button>
    <button id="auth-signout-btn" class="btn btn-sm btn-secondary" onclick="signOutUser()" style="display:none">Sign Out</button>
    <button class="btn btn-sm btn-secondary" onclick="openSettings()" style="padding:6px 8px">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
    </button>
  </div>
</div>


<!-- BUILD TAB -->
<div class="tab-content">
  <div class="tab-panel active" id="tab-build">
    <div class="toggle-group">
      <button class="toggle-btn active" onclick="setBuildMode('quick')">Generate</button>
      <button class="toggle-btn" onclick="setBuildMode('manual')">Manual</button>
    </div>

    <!-- Current Workout -->
    <div id="current-workout" style="display:none; margin-bottom:16px">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2px;">
        <h3 class="section-title" style="margin-bottom:0">Current Workout</h3>
        <button class="btn btn-sm btn-secondary" onclick="clearWorkout()">Clear</button>
      </div>
      <div id="workout-source" style="display:none; font-size:11px; color:var(--text2); margin-bottom:10px;"></div>
      <div id="circuit-toggle-wrap" style="margin-bottom:10px; display:flex; align-items:center; gap:10px;">
        <div class="circuit-toggle" id="circuit-toggle" onclick="toggleCircuitMode()">&#x21bb; Circuit Mode</div>
        <span id="circuit-rounds-label" style="display:none; font-size:12px; color:var(--accent); font-weight:600;"></span>
      </div>
      <div id="workout-exercises"></div>
      <div style="display:flex; gap:8px; margin-top:12px">
        <button class="btn btn-primary" style="flex:1" onclick="startWorkoutTimer()">Start Workout</button>
        <button class="btn btn-secondary" id="view-muscles-btn" onclick="switchTab('diagram')">View Muscles</button>
      </div>
    </div>

    <!-- Saved Workout Source Bar (shown after loading a saved workout) -->
    <div id="saved-source-bar" style="display:none; padding:10px 14px; background:var(--surface); border-radius:10px; margin-bottom:12px; cursor:pointer; align-items:center; justify-content:space-between; border:1px solid var(--border)" onclick="editLoadedSaved()">
      <span id="saved-source-name" style="font-size:13px; font-weight:600"></span>
      <span style="font-size:12px; color:var(--accent); font-weight:600">Edit</span>
    </div>

    <!-- Quick Generate -->
    <div id="quick-mode">
      <div id="quick-expand-bar" style="display:none; padding:10px 14px; background:var(--surface); border-radius:10px; margin-bottom:12px; cursor:pointer; align-items:center; justify-content:space-between; border:1px solid var(--border)" onclick="toggleQuickSettings()">
        <span id="quick-expand-summary" style="font-size:13px; font-weight:600">Full Body · 20 min</span>
        <span style="font-size:12px; color:var(--accent); font-weight:600">Edit</span>
      </div>
      <div id="quick-settings">
      <label>Focus Area</label>
      <div class="focus-grid">
        <div class="focus-card selected" data-focus="full" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <!-- Vitruvian Man - full figure in circle/square -->
            <circle class="davinci" cx="40" cy="40" r="34" stroke-dasharray="2,2"/>
            <rect class="davinci-detail" x="10" y="8" width="60" height="68" rx="1"/>
            <!-- Body -->
            <circle class="davinci" cx="40" cy="20" r="5"/>
            <line class="davinci" x1="40" y1="25" x2="40" y2="50"/>
            <!-- Arms spread -->
            <line class="davinci" x1="40" y1="30" x2="18" y2="24"/>
            <line class="davinci" x1="40" y1="30" x2="62" y2="24"/>
            <!-- Arms down -->
            <line class="davinci-detail" x1="40" y1="30" x2="22" y2="42"/>
            <line class="davinci-detail" x1="40" y1="30" x2="58" y2="42"/>
            <!-- Legs spread -->
            <line class="davinci" x1="40" y1="50" x2="25" y2="72"/>
            <line class="davinci" x1="40" y1="50" x2="55" y2="72"/>
            <!-- Legs together -->
            <line class="davinci-detail" x1="40" y1="50" x2="36" y2="74"/>
            <line class="davinci-detail" x1="40" y1="50" x2="44" y2="74"/>
          </svg></div>Full Body
        </div>
        <div class="focus-card" data-focus="upper" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <circle class="davinci" cx="40" cy="16" r="6"/>
            <line class="davinci" x1="40" y1="22" x2="40" y2="52"/>
            <line class="davinci" x1="26" y1="30" x2="54" y2="30"/>
            <path class="davinci" d="M26,30 Q20,34 16,44 Q14,50 16,56"/>
            <path class="davinci" d="M54,30 Q60,34 64,44 Q66,50 64,56"/>
            <path class="davinci-detail" d="M26,28 Q22,26 20,30 Q18,34 20,36"/>
            <path class="davinci-detail" d="M54,28 Q58,26 60,30 Q62,34 60,36"/>
            <path class="davinci-detail" d="M32,32 Q40,38 48,32"/>
            <path class="davinci-detail" d="M34,36 Q40,40 46,36"/>
            <line class="davinci-detail" x1="16" y1="56" x2="14" y2="66"/>
            <line class="davinci-detail" x1="64" y1="56" x2="66" y2="66"/>
            <line class="davinci-detail" x1="36" y1="52" x2="34" y2="70" opacity="0.3"/>
            <line class="davinci-detail" x1="44" y1="52" x2="46" y2="70" opacity="0.3"/>
          </svg></div>Upper Body
        </div>
        <div class="focus-card" data-focus="lower" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <path class="davinci" d="M26,14 Q32,10 40,10 Q48,10 54,14 L56,20 Q48,24 40,24 Q32,24 24,20 Z"/>
            <path class="davinci" d="M30,22 Q28,36 26,50 Q25,58 28,66"/>
            <path class="davinci" d="M38,24 Q36,38 35,52 Q34,60 36,66"/>
            <path class="davinci" d="M42,24 Q44,38 45,52 Q46,60 44,66"/>
            <path class="davinci" d="M50,22 Q52,36 54,50 Q55,58 52,66"/>
            <ellipse class="davinci-detail" cx="32" cy="54" rx="5" ry="3"/>
            <ellipse class="davinci-detail" cx="48" cy="54" rx="5" ry="3"/>
            <path class="davinci" d="M28,66 Q30,72 30,78"/>
            <path class="davinci" d="M36,66 Q34,72 34,78"/>
            <path class="davinci" d="M44,66 Q46,72 46,78"/>
            <path class="davinci" d="M52,66 Q50,72 50,78"/>
            <line class="davinci-detail" x1="34" y1="28" x2="34" y2="48"/>
            <line class="davinci-detail" x1="46" y1="28" x2="46" y2="48"/>
          </svg></div>Lower Body
        </div>
        <div class="focus-card" data-focus="core" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <path class="davinci" d="M22,10 Q30,6 40,6 Q50,6 58,10 L60,16 Q58,28 56,36 L54,42 Q48,46 40,46 Q32,46 26,42 L24,36 Q22,28 20,16 Z"/>
            <line class="davinci" x1="40" y1="14" x2="40" y2="46"/>
            <path class="davinci-detail" d="M32,18 Q40,20 48,18"/>
            <path class="davinci-detail" d="M31,26 Q40,28 49,26"/>
            <path class="davinci-detail" d="M30,34 Q40,36 50,34"/>
            <path class="davinci-detail" d="M30,42 Q40,44 50,42"/>
            <path class="davinci-detail" d="M22,14 Q24,22 26,32 Q28,40 30,46"/>
            <path class="davinci-detail" d="M58,14 Q56,22 54,32 Q52,40 50,46"/>
            <path class="davinci" d="M26,46 Q32,54 40,56 Q48,54 54,46"/>
            <path class="davinci-detail" d="M22,48 Q24,52 28,50"/>
            <path class="davinci-detail" d="M58,48 Q56,52 52,50"/>
            <ellipse class="davinci-detail" cx="40" cy="40" rx="2" ry="2.5"/>
            <line class="davinci-detail" x1="34" y1="20" x2="36" y2="24" opacity="0.3"/>
            <line class="davinci-detail" x1="44" y1="20" x2="46" y2="24" opacity="0.3"/>
            <line class="davinci-detail" x1="34" y1="28" x2="36" y2="32" opacity="0.3"/>
            <line class="davinci-detail" x1="44" y1="28" x2="46" y2="32" opacity="0.3"/>
          </svg></div>Core
        </div>
        <div class="focus-card" data-focus="posterior" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <circle class="davinci" cx="40" cy="12" r="5"/>
            <line class="davinci" x1="40" y1="17" x2="40" y2="50"/>
            <line class="davinci-detail" x1="38" y1="22" x2="42" y2="22"/>
            <line class="davinci-detail" x1="38" y1="27" x2="42" y2="27"/>
            <line class="davinci-detail" x1="38" y1="32" x2="42" y2="32"/>
            <line class="davinci-detail" x1="38" y1="37" x2="42" y2="37"/>
            <line class="davinci-detail" x1="38" y1="42" x2="42" y2="42"/>
            <path class="davinci" d="M28,20 Q24,24 24,30 Q26,34 32,32 Q36,28 34,22 Z"/>
            <path class="davinci" d="M52,20 Q56,24 56,30 Q54,34 48,32 Q44,28 46,22 Z"/>
            <path class="davinci-detail" d="M30,32 Q26,38 24,44 Q28,48 34,46"/>
            <path class="davinci-detail" d="M50,32 Q54,38 56,44 Q52,48 46,46"/>
            <path class="davinci" d="M30,50 Q28,56 30,62 Q36,64 40,60"/>
            <path class="davinci" d="M50,50 Q52,56 50,62 Q44,64 40,60"/>
            <line class="davinci" x1="32" y1="62" x2="30" y2="76"/>
            <line class="davinci" x1="36" y1="62" x2="36" y2="76"/>
            <line class="davinci" x1="48" y1="62" x2="50" y2="76"/>
            <line class="davinci" x1="44" y1="62" x2="44" y2="76"/>
            <path class="davinci-detail" d="M36,20 Q37,30 36,40 Q36,46 38,50"/>
            <path class="davinci-detail" d="M44,20 Q43,30 44,40 Q44,46 42,50"/>
          </svg></div>Posterior Chain
        </div>
        <div class="focus-card" data-focus="conditioning" onclick="selectFocus(this)">
          <div class="focus-card-icon"><svg viewBox="0 0 80 80">
            <circle class="davinci" cx="44" cy="12" r="5"/>
            <line class="davinci" x1="44" y1="17" x2="38" y2="40"/>
            <path class="davinci" d="M42,24 Q50,28 56,22 Q60,18 62,20"/>
            <path class="davinci" d="M42,24 Q34,22 28,28 Q24,32 22,30"/>
            <path class="davinci" d="M38,40 Q44,48 48,56 Q50,62 46,70"/>
            <path class="davinci" d="M38,40 Q30,48 24,56 Q20,62 22,70"/>
            <line class="davinci-detail" x1="60" y1="14" x2="66" y2="12" opacity="0.4"/>
            <line class="davinci-detail" x1="60" y1="18" x2="66" y2="18" opacity="0.4"/>
            <line class="davinci-detail" x1="60" y1="22" x2="66" y2="24" opacity="0.4"/>
            <path class="davinci-detail" d="M40,30 Q36,34 38,38"/>
            <path class="davinci-detail" d="M44,44 Q48,48 48,54"/>
            <line class="davinci-detail" x1="16" y1="72" x2="64" y2="72" stroke-dasharray="3,3"/>
          </svg></div>Conditioning
        </div>
      </div>

      <label>Duration</label>
      <div class="duration-pills">
        <div class="duration-pill" data-dur="15" onclick="selectDuration(this)">15 min</div>
        <div class="duration-pill selected" data-dur="20" onclick="selectDuration(this)">20 min</div>
        <div class="duration-pill" data-dur="30" onclick="selectDuration(this)">30 min</div>
        <div class="duration-pill" data-dur="45" onclick="selectDuration(this)">45 min</div>
      </div>

      <div id="weight-note" style="font-size:12px; color:var(--text2); margin-bottom:10px; padding:8px; background:var(--surface2); border-radius:8px;">
        Using preferred weight: <strong id="pref-weight-display">16 kg</strong> <span style="opacity:.6">( change in Settings )</span>
      </div>

      <button class="btn btn-primary btn-block" onclick="generateWorkout()" style="margin-top:8px">Generate Workout</button>
      </div>
    </div>

    <!-- Manual Build -->
    <div id="manual-mode" style="display:none">
      <div class="search-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input type="text" id="exercise-search" placeholder="Search exercises..." oninput="filterExercises()">
      </div>
      <div style="display:flex;gap:8px;margin-bottom:12px">
        <div class="form-group" style="flex:1;margin-bottom:0">
          <select id="category-filter" onchange="filterExercises()">
            <option value="all">All Categories</option>
            <option value="swing">Swings</option>
            <option value="press">Presses</option>
            <option value="squat">Squats</option>
            <option value="pull">Pulls / Rows</option>
            <option value="core">Core</option>
            <option value="carry">Carries</option>
            <option value="arms">Arms</option>
            <option value="complex">Complexes</option>
            <option value="cardio">Cardio</option>
            <option value="mat">Mat / Bodyweight</option>
          </select>
        </div>
        <div class="form-group" style="flex:1;margin-bottom:0">
          <select id="sort-filter" onchange="filterExercises()">
            <option value="default">Sort: Default</option>
            <option value="alpha">Sort: A–Z</option>
            <option value="difficulty">Sort: Difficulty</option>
            <option value="equipment">Sort: Equipment</option>
          </select>
        </div>
      </div>
      <div id="exercise-list"></div>
    </div>

  </div>

  <!-- SAVED TAB -->
  <div class="tab-panel" id="tab-saved">
    <div class="auth-gate" id="auth-gate-saved" style="display:none">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
      <h3>Sign in to save workouts</h3>
      <p>Save your favorite workouts and access them from any device.</p>
      <button class="btn btn-primary" onclick="signInWithGoogle()">Sign in with Google</button>
    </div>
    <div id="saved-content">
    <div class="section-title">Saved Workouts</div>
    <div id="saved-list"></div>
    <div id="saved-empty" class="empty-state">
      <p>No saved workouts yet. Star a workout when logging to save it here.</p>
    </div>
    <!-- Edit Saved Workout Screen -->
    <div id="saved-edit" style="display:none">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <button class="btn btn-sm btn-secondary" onclick="closeSavedEdit()" style="padding:6px 8px">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h3 class="section-title" style="margin-bottom:0;flex:1">Edit Saved Workout</h3>
      </div>
      <div id="saved-edit-usage" style="font-size:11px;color:var(--text2);margin-bottom:12px"></div>
      <div class="form-group">
        <label>Workout Name</label>
        <input type="text" id="saved-edit-name" placeholder="Name your workout...">
      </div>
      <div class="form-group">
        <label>Notes</label>
        <input type="text" id="saved-edit-notes" placeholder="Add notes (optional)">
      </div>
      <label>Exercises</label>
      <div id="saved-edit-exercises" style="margin-bottom:14px"></div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-primary" style="flex:1" onclick="saveSavedEdit()">Save Changes</button>
        <button class="btn btn-secondary" onclick="loadFromEdit()">Load</button>
      </div>
      <button class="btn btn-sm" style="width:100%;margin-top:12px;color:var(--red);background:none;border:1px solid var(--red);border-radius:8px" onclick="deleteFromEdit()">Delete Workout</button>
    </div>
  </div><!-- /saved-content -->
  </div>

  <!-- DIAGRAM TAB -->
  <div class="tab-panel" id="tab-diagram">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
      <button class="btn btn-sm btn-secondary" onclick="switchTab('build')" style="padding:6px 8px">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      </button>
      <div class="section-title" style="margin-bottom:0;flex:1">Muscle Activation</div>
    </div>
    <div id="diagram-context" style="font-size:13px; color:var(--text2); margin-bottom:14px;">Tap a muscle group to see which exercises activate it.</div>

    <div class="diagram-container">
      <div class="body-view">
        <h3>FRONT</h3>
        <svg class="body-svg" id="svg-front" viewBox="0 0 200 450">
          <!-- Head -->
          <ellipse class="outline" cx="100" cy="30" rx="22" ry="26"/>
          <!-- Neck -->
          <rect class="outline" x="90" y="56" width="20" height="14" rx="4"/>
          <!-- Torso outline -->
          <path class="outline" d="M60,70 Q55,70 50,80 L42,130 Q40,155 50,180 L55,200 Q60,210 65,215 L70,220 Q80,225 100,225 Q120,225 130,220 L135,215 Q140,210 145,200 L150,180 Q160,155 158,130 L150,80 Q145,70 140,70 Z"/>

          <!-- Chest (left) -->
          <path class="muscle" id="front-chest-l" data-muscle="chest" d="M60,75 Q58,78 54,85 L48,110 Q50,120 60,118 L95,105 L95,75 Q80,70 60,75 Z"/>
          <!-- Chest (right) -->
          <path class="muscle" id="front-chest-r" data-muscle="chest" d="M140,75 Q142,78 146,85 L152,110 Q150,120 140,118 L105,105 L105,75 Q120,70 140,75 Z"/>

          <!-- Shoulders (left) -->
          <path class="muscle" id="front-shoulder-l" data-muscle="shoulders" d="M55,70 Q38,72 32,88 L40,110 L50,85 Z"/>
          <!-- Shoulders (right) -->
          <path class="muscle" id="front-shoulder-r" data-muscle="shoulders" d="M145,70 Q162,72 168,88 L160,110 L150,85 Z"/>

          <!-- Abs -->
          <path class="muscle" id="front-abs" data-muscle="abs" d="M80,110 L80,200 Q90,210 100,210 Q110,210 120,200 L120,110 Q110,105 100,105 Q90,105 80,110 Z"/>

          <!-- Obliques (left) -->
          <path class="muscle" id="front-oblique-l" data-muscle="obliques" d="M55,118 L48,130 Q43,155 50,180 L60,200 L65,215 Q70,218 78,205 L78,110 Q68,115 55,118 Z"/>
          <!-- Obliques (right) -->
          <path class="muscle" id="front-oblique-r" data-muscle="obliques" d="M145,118 L152,130 Q157,155 150,180 L140,200 L135,215 Q130,218 122,205 L122,110 Q132,115 145,118 Z"/>

          <!-- Biceps (left) -->
          <path class="muscle" id="front-bicep-l" data-muscle="biceps" d="M32,95 L26,115 Q24,135 28,155 L38,155 Q42,135 40,115 Z"/>
          <!-- Biceps (right) -->
          <path class="muscle" id="front-bicep-r" data-muscle="biceps" d="M168,95 L174,115 Q176,135 172,155 L162,155 Q158,135 160,115 Z"/>

          <!-- Forearms (left) -->
          <path class="muscle" id="front-forearm-l" data-muscle="forearms" d="M28,158 L22,200 Q20,220 24,240 L34,240 Q36,220 34,200 L38,158 Z"/>
          <!-- Forearms (right) -->
          <path class="muscle" id="front-forearm-r" data-muscle="forearms" d="M172,158 L178,200 Q180,220 176,240 L166,240 Q164,220 166,200 L162,158 Z"/>

          <!-- Quads (left) -->
          <path class="muscle" id="front-quad-l" data-muscle="quads" d="M68,222 L60,280 Q58,310 62,340 L88,340 Q92,310 90,280 L95,222 Q82,228 68,222 Z"/>
          <!-- Quads (right) -->
          <path class="muscle" id="front-quad-r" data-muscle="quads" d="M132,222 L140,280 Q142,310 138,340 L112,340 Q108,310 110,280 L105,222 Q118,228 132,222 Z"/>

          <!-- Hip flexors -->
          <path class="muscle" id="front-hipflexor-l" data-muscle="hip_flexors" d="M78,210 L68,222 L95,222 L92,210 Z"/>
          <path class="muscle" id="front-hipflexor-r" data-muscle="hip_flexors" d="M122,210 L132,222 L105,222 L108,210 Z"/>

          <!-- Calves (front, tibialis) -->
          <path class="muscle" id="front-calf-l" data-muscle="calves" d="M64,345 L62,380 Q60,400 64,420 L86,420 Q90,400 88,380 L86,345 Z"/>
          <path class="muscle" id="front-calf-r" data-muscle="calves" d="M136,345 L138,380 Q140,400 136,420 L114,420 Q110,400 112,380 L114,345 Z"/>
        </svg>
      </div>

      <div class="body-view">
        <h3>BACK</h3>
        <svg class="body-svg" id="svg-back" viewBox="0 0 200 450">
          <!-- Head -->
          <ellipse class="outline" cx="100" cy="30" rx="22" ry="26"/>
          <!-- Neck -->
          <rect class="outline" x="90" y="56" width="20" height="14" rx="4"/>
          <!-- Torso outline -->
          <path class="outline" d="M60,70 Q55,70 50,80 L42,130 Q40,155 50,180 L55,200 Q60,210 65,215 L70,220 Q80,225 100,225 Q120,225 130,220 L135,215 Q140,210 145,200 L150,180 Q160,155 158,130 L150,80 Q145,70 140,70 Z"/>

          <!-- Traps -->
          <path class="muscle" id="back-traps" data-muscle="traps" d="M75,68 L60,72 L54,85 L70,95 L95,80 L95,72 Z"/>
          <path class="muscle" id="back-traps-r" data-muscle="traps" d="M125,68 L140,72 L146,85 L130,95 L105,80 L105,72 Z"/>

          <!-- Rear delts -->
          <path class="muscle" id="back-reardelt-l" data-muscle="shoulders" d="M55,70 Q38,72 32,88 L40,110 L50,85 Z"/>
          <path class="muscle" id="back-reardelt-r" data-muscle="shoulders" d="M145,70 Q162,72 168,88 L160,110 L150,85 Z"/>

          <!-- Lats (left) -->
          <path class="muscle" id="back-lat-l" data-muscle="lats" d="M56,95 L48,115 Q44,140 48,165 L58,180 L75,170 L80,115 L70,100 Z"/>
          <!-- Lats (right) -->
          <path class="muscle" id="back-lat-r" data-muscle="lats" d="M144,95 L152,115 Q156,140 152,165 L142,180 L125,170 L120,115 L130,100 Z"/>

          <!-- Lower back -->
          <path class="muscle" id="back-lowerback" data-muscle="lower_back" d="M78,120 L78,200 Q90,210 100,210 Q110,210 122,200 L122,120 Q110,115 100,115 Q90,115 78,120 Z"/>

          <!-- Triceps (left) -->
          <path class="muscle" id="back-tricep-l" data-muscle="triceps" d="M32,95 L26,115 Q24,135 28,155 L38,155 Q42,135 40,115 Z"/>
          <!-- Triceps (right) -->
          <path class="muscle" id="back-tricep-r" data-muscle="triceps" d="M168,95 L174,115 Q176,135 172,155 L162,155 Q158,135 160,115 Z"/>

          <!-- Forearms back -->
          <path class="muscle" id="back-forearm-l" data-muscle="forearms" d="M28,158 L22,200 Q20,220 24,240 L34,240 Q36,220 34,200 L38,158 Z"/>
          <path class="muscle" id="back-forearm-r" data-muscle="forearms" d="M172,158 L178,200 Q180,220 176,240 L166,240 Q164,220 166,200 L162,158 Z"/>

          <!-- Glutes -->
          <path class="muscle" id="back-glute-l" data-muscle="glutes" d="M65,210 L60,230 Q62,250 75,255 L97,250 L97,210 Q82,215 65,210 Z"/>
          <path class="muscle" id="back-glute-r" data-muscle="glutes" d="M135,210 L140,230 Q138,250 125,255 L103,250 L103,210 Q118,215 135,210 Z"/>

          <!-- Hamstrings (left) -->
          <path class="muscle" id="back-ham-l" data-muscle="hamstrings" d="M62,255 L58,290 Q56,320 60,345 L88,345 Q92,320 90,290 L92,255 Q78,260 62,255 Z"/>
          <!-- Hamstrings (right) -->
          <path class="muscle" id="back-ham-r" data-muscle="hamstrings" d="M138,255 L142,290 Q144,320 140,345 L112,345 Q108,320 110,290 L108,255 Q122,260 138,255 Z"/>

          <!-- Calves (back) -->
          <path class="muscle" id="back-calf-l" data-muscle="calves" d="M62,348 L60,380 Q58,400 62,420 L86,420 Q90,400 88,380 L86,348 Z"/>
          <path class="muscle" id="back-calf-r" data-muscle="calves" d="M138,348 L140,380 Q142,400 138,420 L114,420 Q110,400 112,380 L114,348 Z"/>
        </svg>
      </div>
    </div>

    <!-- Legend -->
    <div class="muscle-legend" id="muscle-legend"></div>

    <div id="diagram-workout-summary" class="card" style="display:none;">
      <div style="font-size:12px; color:var(--text2); text-transform:uppercase; letter-spacing:1px; margin-bottom:6px;">Current Workout</div>
      <div id="diagram-summary-list"></div>
    </div>
  </div>

  <!-- LOG TAB -->
  <div class="tab-panel" id="tab-log">
    <div class="auth-gate" id="auth-gate-log" style="display:none">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      <h3>Sign in to track workouts</h3>
      <p>Keep a log of every workout and track your progress over time.</p>
      <button class="btn btn-primary" onclick="signInWithGoogle()">Sign in with Google</button>
    </div>
    <div id="log-content">
    <div class="section-title">Workout Log</div>
    <div class="calendar card" id="calendar"></div>
    <div id="log-list"></div>
    <div id="log-empty" class="empty-state">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
      <p>No workouts logged yet</p>
    </div>
    </div><!-- /log-content -->
  </div>

  <!-- INSIGHTS TAB -->
  <div class="tab-panel" id="tab-insights">
    <div class="auth-gate" id="auth-gate-insights" style="display:none">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0"/></svg>
      <h3>Sign in for insights</h3>
      <p>See your top exercises, weekly volume, muscle coverage, and personalized suggestions.</p>
      <button class="btn btn-primary" onclick="signInWithGoogle()">Sign in with Google</button>
    </div>
    <div id="insights-content">
    <div class="section-title">Insights</div>

    <div class="card insight-card">
      <h3><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg> Top 5 Exercises</h3>
      <ol class="rank-list" id="top-exercises">
        <li class="empty-state" style="padding:10px"><p>Log workouts to see your top exercises</p></li>
      </ol>
    </div>

    <div class="card insight-card">
      <h3><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg> Weekly Volume</h3>
      <div class="chart-container">
        <canvas class="chart-canvas" id="volume-chart"></canvas>
      </div>
    </div>

    <div class="card insight-card">
      <h3><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--blue)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg> Muscle Coverage</h3>
      <div class="heatmap-controls">
        <button class="heatmap-btn active" data-days="7" onclick="setHeatmapRange(this,7)">7 days</button>
        <button class="heatmap-btn" data-days="14" onclick="setHeatmapRange(this,14)">14 days</button>
        <button class="heatmap-btn" data-days="30" onclick="setHeatmapRange(this,30)">30 days</button>
      </div>
      <div class="diagram-container" id="heatmap-diagram"></div>
    </div>

    <div class="card insight-card">
      <h3><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--purple)" stroke-width="2"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0"/></svg> Try These Next</h3>
      <div id="suggestions-list">
        <div class="empty-state" style="padding:10px"><p>Log workouts to get suggestions</p></div>
      </div>
    </div>
    </div><!-- /insights-content -->
  </div>
</div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <button class="nav-btn active" onclick="switchTab('build')" data-tab="build">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
    Build
  </button>
  <button class="nav-btn" onclick="switchTab('saved')" data-tab="saved">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
    Saved
  </button>
  <button class="nav-btn" onclick="switchTab('diagram')" data-tab="diagram">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    Muscles
  </button>
  <button class="nav-btn" onclick="switchTab('log')" data-tab="log">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
    Log
  </button>
  <button class="nav-btn" onclick="switchTab('insights')" data-tab="insights">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
    Insights
  </button>
</nav>

<!-- Overlay for muscle popup -->
<div class="overlay" id="overlay" onclick="closeMusclePopup()"></div>
<div class="muscle-popup" id="muscle-popup">
  <h3 id="popup-muscle-name"></h3>
  <div id="popup-exercises"></div>
</div>

<!-- Log Workout Modal -->
<div class="modal" id="log-modal">
  <div class="modal-backdrop" onclick="closeLogModal()"></div>
  <div class="modal-content">
    <h2>Log Workout</h2>
    <div class="form-group">
      <label>Date</label>
      <input type="date" id="log-date">
    </div>
    <div id="log-exercise-summary" style="margin-bottom:14px"></div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;padding:10px;background:var(--surface2);border-radius:8px;cursor:pointer" onclick="toggleStar()">
      <svg id="star-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      <div><div style="font-size:13px;font-weight:600">Save as favorite</div><div style="font-size:11px;color:var(--text2)">Quickly reload this workout later</div></div>
    </div>
    <div id="save-name-group" style="display:none;margin-bottom:12px">
      <label>Workout Name</label>
      <input type="text" id="save-name" placeholder="e.g. Leg Day, Morning Flow, The Destroyer...">
    </div>
    <details style="margin-bottom:12px">
      <summary style="font-size:12px;color:var(--text2);cursor:pointer">Add notes (optional)</summary>
      <input type="text" id="log-notes" placeholder="How did it feel?" style="margin-top:6px">
    </details>
    <div style="display:flex; gap:8px">
      <button class="btn btn-primary" style="flex:1" onclick="saveWorkoutLog()">Save</button>
      <button class="btn btn-secondary" onclick="closeLogModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal" id="settings-modal">
  <div class="modal-backdrop" onclick="closeSettings()"></div>
  <div class="modal-content">
    <h2>Settings</h2>
    <div class="form-group">
      <label>Experience Level</label>
      <div id="difficulty-count" style="font-size:11px; color:var(--text2); margin:0 0 8px; opacity:.7"></div>
      <div class="toggle-group" id="difficulty-toggle">
        <button class="toggle-btn" onclick="setDifficulty('beginner')">Beginner</button>
        <button class="toggle-btn active" onclick="setDifficulty('intermediate')">Intermediate</button>
        <button class="toggle-btn" onclick="setDifficulty('advanced')">Advanced</button>
      </div>
    </div>
    <div class="form-group">
      <label>Unit Preference</label>
      <select id="unit-pref" onchange="saveSettings()">
        <option value="kg">Kilograms (kg)</option>
        <option value="lb">Pounds (lb)</option>
      </select>
    </div>
    <div class="form-group">
      <label>Kettlebells You Own</label>
      <p style="font-size:11px; color:var(--text2); margin:0 0 8px; opacity:.7">Tap to toggle</p>
      <div id="owned-weights"></div>
    </div>
    <div class="form-group">
      <label>Preferred Weight</label>
      <p style="font-size:11px; color:var(--text2); margin:0 0 8px; opacity:.7">Tap the weight that you prefer to use for most exercises</p>
      <div class="weight-chips" id="preferred-weight"></div>
    </div>
    <div style="display:flex; gap:8px; margin-top:14px;">
      <button class="btn btn-primary" style="flex:1" onclick="closeSettings()">Done</button>
    </div>
  </div>
</div>

<!-- Migration Modal -->
<div class="modal" id="migration-modal">
  <div class="modal-backdrop" onclick="skipMigration()"></div>
  <div class="modal-content" style="max-width:340px;text-align:center">
    <h2>Import Local Data?</h2>
    <p id="migration-msg" style="font-size:13px;color:var(--text2);line-height:1.5">You have workout data saved on this device. Would you like to import it to your account?</p>
    <div style="display:flex;gap:8px;margin-top:14px">
      <button class="btn btn-secondary" style="flex:1" onclick="skipMigration()">Skip</button>
      <button class="btn btn-primary" style="flex:1" onclick="runMigration()">Import</button>
    </div>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<script src="firebase-config.js"></script>
<script src="firebase-sync.js"></script>
<script src="app.js"></script>
</body>
</html>
